
{% extends "base.html" %}
{% block title %}Enviar por WhatsApp{% endblock %}
{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card p-0 hover-card">
        <div class="card-body text-center">
          <h4 class="mb-2"><i class="bi bi-whatsapp me-2"></i> Enviar entrada por WhatsApp</h4>
          <p class="text-muted">Se abrirá una pestaña con WhatsApp Web con el mensaje listo para <strong>{{ cliente }}</strong>.</p>

          <div class="my-3">
            <img src="{{ qr_img_url }}" alt="QR" style="max-height:220px;border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,.15)">
            <div class="small text-muted mt-2">Código: {{ codigo_qr }}</div>
          </div>

          <div class="d-grid gap-2 d-sm-flex justify-content-sm-center">
            <a class="btn btn-success" href="{{ wa_url }}" target="_blank" rel="noopener">
              <i class="bi bi-box-arrow-up-right me-2"></i>Abrir WhatsApp Web
            </a>
            <a class="btn btn-outline-primary" href="{{ url_for('ventas') }}">
              <i class="bi bi-arrow-left me-2"></i>Volver a Ventas
            </a>
          </div>
          <p class="mt-3 small text-muted">
            Si WhatsApp no adjunta la imagen automáticamente, arrastra este QR al chat o adjúntalo con el clip.
          </p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  (function(){
    const opened = sessionStorage.getItem('wa_opened_{{ codigo_qr }}');
    if (!opened) {
      window.open("{{ wa_url }}", "_blank", "noopener");
      sessionStorage.setItem('wa_opened_{{ codigo_qr }}', '1');
    }
  })();
</script>
{% endblock %}
